---
title: Computer Network-Chapter 3-5
tags: 网络
categories: 课程学习
---
<font face="微软雅黑"></font>
<center> 运输层、网络层 </center>

<!-- more -->
<!-- TOC -->

- [第三章 运输层](#第三章-运输层)
  - [概述](#概述)
  - [多路复用与多路分解](#多路复用与多路分解)
  - [无连接运输](#无连接运输)
  - [可靠数据传输原理](#可靠数据传输原理)
  - [面向连接的运输](#面向连接的运输)
  - [TCP拥塞控制](#tcp拥塞控制)
- [第四章 网络层-数据平面](#第四章-网络层-数据平面)
  - [网络层概述](#网络层概述)
  - [路由器工作原理](#路由器工作原理)
  - [网际协议](#网际协议)
  - [通用转发](#通用转发)
- [第五章 网络层-控制平面](#第五章-网络层-控制平面)
  - [路由选择算法](#路由选择算法)
  - [自治系统内部的路由](#自治系统内部的路由)
  - [自治系统间路由选择协议-边界网关协议](#自治系统间路由选择协议-边界网关协议)
  - [控制平面](#控制平面)
  - [因特网控制报文协议](#因特网控制报文协议)
  - [网络管理](#网络管理)

<!-- /TOC -->
#
# 第三章 运输层
## 概述
运输层协议为运行在不同主机上的应用进程之间提供了逻辑通信功能。
运输层协议只工作在端系统中。中间路由器仅作用于数据报的网络层字段，既不处理也不识别运输层报文段。

## 多路复用与多路分解
一个进程有一个或多个套接字。
**多路分解**：将运输层报文段的数据交付到正确的套接字的工作
**多路复用**：在源主机从不同的套接字接收数据块，并为每个数据块封装上首部信息从而生产报文段，然后将报文段传递到网络层。
UDP套接字：由一个二元组标识，包含一个目的IP和一个目的端口号。
TCP套接字：由一个四元组标识，包含源IP地址、源端口号、目的IP地址、目的端口号。

## 无连接运输
即UDP。
DNS是一个使用UDP的应用层协议。

UDP的优点（相对于TCP）：
 1. 关于发送什么数据以及何时发送的应用层控制更为精细。TCP有拥塞控制机制
 2. 无需建立连接。TCP三次握手引入建立连接的时延。
 3. 无连接状态。TCP需在端系统中维护连接状态，
 4. 分组首部开销小。TCP-20字节，UDP-8字节。
**UDP报文段结构**
<img src="https://raw.githubusercontent.com/tiandaochouqin1/Sources/main/images/udp.png" alt=UDP报文段 height=300 width=600 align=center>

**UDP检验和**
提供差错检测功能。
发送方的UDP对报文段中的所有16比特字的和进行反码运算，遇到溢出即回卷，得到的结果放在检验和字段。

## 可靠数据传输原理
**1 构建可靠的数据传输协议**
有限状态机、停等协议
<img src="https://raw.githubusercontent.com/tiandaochouqin1/Sources/main/images/rdt3-sender.png" alt=rdt3.0 height=400 width=500 align=center>
**2 流水线可靠数据传输协议**
流水线差错恢复：回退N步（GBN）和选择重传（SR）。

## 面向连接的运输
TCP 在不可靠的（IP)端到端网络层之上实现可靠的数据传输协议。
**TCP报文段结构**
<img src="https://raw.githubusercontent.com/tiandaochouqin1/Sources/main/images/tcp.jpg" alt=TCP报文段 height=400 width=600 align=center>

**往返时间的估计与超时**
超时间隔加倍、快速重传。
冗余ACK：接收方对已经接收到的最后一个按序字节数据进行重复确认。

**流量控制**

## TCP拥塞控制

**拥塞控制原理**
 1. 端到端的拥塞控制
 2. 网络辅助的拥塞控制

TCP使用端到端的拥塞控制，因为IP层不向网络层提供显式的网络拥塞反馈。
**加性增、乘性减**：每个RTT内cwnd线性增加1MSS，然后出现3个冗余ACK事件时cwnd减半。
RTT(Round Trip Time)：一个连接的往返时间，即数据发送时刻到接收到确认的时刻的差值； 
**公平性**
拥有较小RTT的连接能够在链路空闲时更快抢到可用带宽，享有更高吞吐量。
UDP源可能压制TCP流量。

# 第四章 网络层-数据平面
## 网络层概述
**转发**：当一个分组到达路由器的某一条输入链路时，路由器必须将该分组移动到适当的输出链路。转发是在数据平面中中实现的唯一功能。转发表
**路由**：确定分组从源到目的地所采用的端到端路由的网络范围处理过程。在控制平面中实现。SDN方法、
**网络服务模型**：定义了分组在发送与接收端之间的端到端运输特性。
 1. 确保交付
 2. 具有时延上限的确保交付；
 3. 有序分组交付；
 4. 确保最小带宽；
 5. 安全性
网络层提供尽力而为服务。
**链路层交换机**：基于链路层帧中的首部字段进行转发。
**路由器**：基于网络层数据报中的首部字段进行转发。


## 路由器工作原理

<img src="https://raw.githubusercontent.com/tiandaochouqin1/Sources/main/images/router.png" alt=路由器体系结构 height=400 width=600 align=center>

1. 输入端口
基于目的地的转发。
输入端口的线路端接功能与链路层处理实现了用于各个输入链路的物理层和链路层。
2. 交换结构
经内存交换、经总线交换、经互联网络交换
3. 输出端口
4. 路由选择处理器

**分组调度**
 1. 先进先出（FIFO，FCFS）
 2. 优先权排队
 3. 循环和加权公平排队

## 网际协议
**IPv4数据报格式**
<img src="https://raw.githubusercontent.com/tiandaochouqin1/Sources/main/images/IPv4.png" alt=IPv4数据报格式 height=400 width=600 align=center>
**IPv4数据报分片**
链路层协议的MTU严格限制IP数据报的长度。
一个链路层能承载的最大数据量叫做最大传送单元ＭＴＵ。
**IPv4 编址**
主机与物理链路之间的边界叫做**接口**。一个IP地址与一个接口相关联。点分十进制。子网与子网掩码。无类别域间路由选择CIDR：a.b.c.d/x

**获取主机地址：动态主机配置协议**DHCP

**网络地址转换**NAT
使用NAT路由器上的一张NAT转换表。

**IPv6**
<img src="https://raw.githubusercontent.com/tiandaochouqin1/Sources/main/images/IPv6.png" alt=IPv6数据报格式 height=300 width=400 align=center>
无 分片/组装、首部检验和、选项

## 通用转发
每台分组交换机包含一张匹配加动作表。该表示由远程控制器计算和分发的。
**流表**包含：首部字段值的集合、计数器集合、动作集合。

# 第五章 网络层-控制平面
每路由控制：转发表（基于目的地转发）
逻辑集中式控制：流表（通用转发）

## 路由选择算法
1. 集中式路由选择算法：
    具有全局状态信息的算法被称为链路状态（LS）算法。Dijkstra算法
2. 分散式路有选择算法：
    每个节点维护到网络中所有其它节点的开销估计的向量被称为距离向量（DV）算法。
LS与DV比较：报文复杂性、收敛速度、健壮性。

## 自治系统内部的路由
OSPF：开放最短路优先。是一种链路状态协议，他使用洪泛链路状态信息和Dijkstra最低开销路径算法。
## 自治系统间路由选择协议-边界网关协议
**BGP边界网关协议**
 1. 从邻居AS（自治系统）获得前缀（——CIDR）的可达信息；
 2. 确定到该前缀的“最好的”路由器。

**前缀及其属性称为路由。**
 - AS-PATH属性包含了通告已经通过的AS列表。
 - NEXT-SHOP是AS-PATH起始的路由接口的IP地址。
**路由选择**
热土豆路由选择：用尽可能低的开销送出其AS；
**BGP路由表**
**IP任播**

## 控制平面
[SDN体系结构的特征：](https://www.cnblogs.com/born2run/p/9581417.html)
 1. 基于流的转发
 2. 数据平面与控制平面分离
 3. 网络控制功能：位于数据平面交换机外部
 4. 可编程的网络
<img src="https://raw.githubusercontent.com/tiandaochouqin1/Sources/main/images/SDN.png" alt=SDN height=400 width=400 align=center>

## 因特网控制报文协议
ICMP通常被认为是IP的一部分，但是从体系结构上来讲，它位于IP之上。因为ICMP报文是作为IP有效载荷承载的。
ICMP最典型的用途是差错报告。

## 网络管理
SNMP简单网络管理协议v2：是一个应用层协议，用于在管理服务器和代表管理服务器执行的代理之间传递管理控制和信息报文。
SNMP代理向管理服务器发送一种非请求报文，该报文被称为陷阱报文。

<script id="__bs_script__">//<![CDATA[
    document.write("<script async src='http://HOST:3000/browser-sync/browser-sync-client.js?v=2.26.5'><\/script>".replace("HOST", location.hostname));
//]]></script>
